<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/ddcf33dc0eac78c6.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-03f7c6bc932ce1e3.js"/><script src="/_next/static/chunks/fd9d1056-b11b2651f33aae7f.js" async=""></script><script src="/_next/static/chunks/117-c69a8044fb9e6347.js" async=""></script><script src="/_next/static/chunks/main-app-27265cc5b3dcc92c.js" async=""></script><script src="/_next/static/chunks/870fdd6f-2e1ba06dbb163b2e.js" async=""></script><script src="/_next/static/chunks/69b09407-9eb0958119fc55ca.js" async=""></script><script src="/_next/static/chunks/682-3e1fe04c8b44cd29.js" async=""></script><script src="/_next/static/chunks/648-ca5c008ca4413444.js" async=""></script><script src="/_next/static/chunks/519-b283051475233ba7.js" async=""></script><script src="/_next/static/chunks/app/layout-a103402a46f71b56.js" async=""></script><script src="/_next/static/chunks/app/not-found-c0c7afedf3e8e023.js" async=""></script><script src="/_next/static/chunks/app/projects/%5Bid%5D/page-e903bbdb8b222807.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-9KKL3BNRNY" as="script"/><title>Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic</title><meta name="description" content="Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC). ðŸš€"/><link rel="author" href="https://digindominic.me"/><meta name="author" content="Digin Dominic"/><meta name="creator" content="Digin Dominic"/><meta name="publisher" content="Digin Dominic"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/"/><meta name="google-site-verification" content="your-google-verification-code"/><meta property="og:title" content="Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic"/><meta property="og:description" content="Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC). ðŸš€"/><meta property="og:url" content="https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/"/><meta property="og:image" content="https://raw.githubusercontent.com/digin1/web-images/main/ansible.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic"/><meta name="twitter:description" content="Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC). ðŸš€"/><meta name="twitter:image" content="https://raw.githubusercontent.com/digin1/web-images/main/ansible.png"/><link rel="icon" href="/favicon.ico" sizes="any"/><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/android-chrome-192x192.png"/><link rel="manifest" href="/manifest.json"/><meta name="theme-color" content="#3B82F6"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Digin Dominic","url":"https://digindominic.me","image":"https://raw.githubusercontent.com/digin1/web-images/refs/heads/main/profile.webp","jobTitle":"Full Stack Developer","description":"Full Stack Developer & Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.","sameAs":["https://github.com/digin1","https://linkedin.com/in/digin","https://twitter.com/digin1"],"knowsAbout":["React","Node.js","Python","JavaScript","TypeScript","Web Development","Software Engineering"]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Digin Dominic","url":"https://digindominic.me","description":"Full Stack Developer & Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.","author":{"@type":"Person","name":"Digin Dominic"},"potentialAction":{"@type":"SearchAction","target":"https://digindominic.me/projects?search={search_term_string}","query-input":"required name=search_term_string"}}</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="min-h-screen flex flex-col"><script src="/_next/static/chunks/webpack-03f7c6bc932ce1e3.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/ddcf33dc0eac78c6.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[2846,[],\"\"]\n5:I[4707,[],\"\"]\n7:I[6423,[],\"\"]\n8:I[8003,[\"676\",\"static/chunks/870fdd6f-2e1ba06dbb163b2e.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"682\",\"static/chunks/682-3e1fe04c8b44cd29.js\",\"648\",\"static/chunks/648-ca5c008ca4413444.js\",\"519\",\"static/chunks/519-b283051475233ba7.js\",\"185\",\"static/chunks/app/layout-a103402a46f71b56.js\"],\"\"]\n9:I[9567,[\"676\",\"static/chunks/870fdd6f-2e1ba06dbb163b2e.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"682\",\"static/chunks/682-3e1fe04c8b44cd29.js\",\"648\",\"static/chunks/648-ca5c008ca4413444.js\",\"519\",\"static/chunks/519-b283051475233ba7.js\",\"185\",\"static/chunks/app/layout-a103402a46f71b56.js\"],\"ThemeProvider\"]\na:I[1794,[\"676\",\"static/chunks/870fdd6f-2e1ba06dbb163b2e.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"682\",\"static/chunks/682-3e1fe04c8b44cd29.js\",\"648\",\"static/chunks/648-ca5c008ca4413444.js\",\"519\",\"static/chunks/519-b283051475233ba7.js\",\"185\",\"static/chunks/app/layout-a103402a46f71b56.js\"],\"default\"]\nb:I[3039,[\"676\",\"static/chunks/870fdd6f-2e1ba06dbb163b2e.js\",\"682\",\"static/chunks/682-3e1fe04c8b44cd29.js\",\"648\",\"static/chunks/648-ca5c008ca4413444.js\",\"160\",\"static/chunks/app/not-found-c0c7afedf3e8e023.js\"],\"default\"]\nc:I[9547,[\"676\",\"static/chunks/870fdd6f-2e1ba06dbb163b2e.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"682\",\"static/chunks/682-3e1fe04c8b44cd29.js\",\"648\",\"static/chunks/648-ca5c008ca4413444.js\",\"519\",\"static/chunks/519-b283051475233ba7.js\",\"185\",\"static/chunks/app/layout-a103402a46f71b56.js\"],\"default\"]\ne:I[1060,[],\"\"]\n6:[\"id\",\"automating-secure-infrastructure-with-ansible-project\",\"d\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L2\",null,{\"buildId\":\"AnKDAAT4R-quPv5a2qq_b\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"projects\",\"automating-secure-infrastructure-with-ansible-project\",\"\"],\"initialTree\":[\"\",{\"children\":[\"projects\",{\"children\":[[\"id\",\"automating-secure-infrastructure-with-ansible-project\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"automating-secure-infrastructure-with-ansible-project\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"projects\",{\"children\":[[\"id\",\"automating-secure-infrastructure-with-ansible-project\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\",null],null],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ddcf33dc0eac78c6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"sizes\":\"any\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.svg\",\"type\":\"image/svg+xml\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/android-chrome-192x192.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/manifest.json\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#3B82F6\"}],[\"$\",\"link\",null,{\"rel\":\"sitemap\",\"type\":\"application/xml\",\"href\":\"/sitemap.xml\"}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Digin Dominic\\\",\\\"url\\\":\\\"https://digindominic.me\\\",\\\"image\\\":\\\"https://raw.githubusercontent.com/digin1/web-images/refs/heads/main/profile.webp\\\",\\\"jobTitle\\\":\\\"Full Stack Developer\\\",\\\"description\\\":\\\"Full Stack Developer \u0026 Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.\\\",\\\"sameAs\\\":[\\\"https://github.com/digin1\\\",\\\"https://linkedin.com/in/digin\\\",\\\"https://twitter.com/digin1\\\"],\\\"knowsAbout\\\":[\\\"React\\\",\\\"Node.js\\\",\\\"Python\\\",\\\"JavaScript\\\",\\\"TypeScript\\\",\\\"Web Development\\\",\\\"Software Engineering\\\"]}\"}}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"WebSite\\\",\\\"name\\\":\\\"Digin Dominic\\\",\\\"url\\\":\\\"https://digindominic.me\\\",\\\"description\\\":\\\"Full Stack Developer \u0026 Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.\\\",\\\"author\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Digin Dominic\\\"},\\\"potentialAction\\\":{\\\"@type\\\":\\\"SearchAction\\\",\\\"target\\\":\\\"https://digindominic.me/projects?search={search_term_string}\\\",\\\"query-input\\\":\\\"required name=search_term_string\\\"}}\"}}]]}],[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col\",\"children\":[[\"$\",\"$L8\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-9KKL3BNRNY\",\"strategy\":\"afterInteractive\"}],[\"$\",\"$L8\",null,{\"id\":\"google-analytics\",\"strategy\":\"afterInteractive\",\"children\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', 'G-9KKL3BNRNY');\\n          \"}],[\"$\",\"$L9\",null,{\"children\":[[\"$\",\"$La\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 pt-20\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$Lb\",null,{}],\"notFoundStyles\":[]}]}],[\"$\",\"$Lc\",null,{}]]}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]\n"])</script><script>self.__next_f.push([1,"10:I[850,[\"676\",\"static/chunks/870fdd6f-2e1ba06dbb163b2e.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"682\",\"static/chunks/682-3e1fe04c8b44cd29.js\",\"648\",\"static/chunks/648-ca5c008ca4413444.js\",\"626\",\"static/chunks/app/projects/%5Bid%5D/page-e903bbdb8b222807.js\"],\"default\"]\n11:T20b8,"])</script><script>self.__next_f.push([1,"\u003ch2\u003e\u003cstrong\u003eIntroduction\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eInfrastructure automation is a critical aspect of modern system administration. My project focused on using \u003cstrong\u003eAnsible\u003c/strong\u003e to automate essential administrative tasks such as:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eManaging SSH Key Authentication\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCreating and Removing Users Securely\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConfiguring Sudoers for Role-Based Access Control\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMonitoring and Logging Sudo Actions\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDeploying Security Enhancements (Safe Deletion, Password Policies, etc.)\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe primary goal was to create an automated, repeatable, and scalable solution for managing user access and securing the infrastructure.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003e\u003cstrong\u003e1. SSH Key Management and Secure Access Automation\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eOne of the core challenges in multi-node environments is \u003cstrong\u003esecure authentication\u003c/strong\u003e. Instead of relying on password-based access, I automated \u003cstrong\u003eSSH key generation, distribution, and configuration\u003c/strong\u003e.\u003c/p\u003e\n\u003ch3\u003e\u003cstrong\u003eGenerating and Distributing SSH Keys\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eAnsible was used to generate SSH keys for different hosts and copy them to the appropriate machines.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePlaybook for Generating SSH Keys (Conditional Execution to Avoid Overwriting):\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Generate SSH keys for root if they donâ€™t exist\n  hosts: all\n  become: false\n  tasks:\n    - name: Check if root SSH key exists\n      stat:\n        path: \"~/.ssh/id_rsa\"\n      register: ssh_key_check\n\n    - name: Generate SSH key for root\n      shell: ssh-keygen -t rsa -N '' -f ~/.ssh/id_rsa\n      when: not ssh_key_check.stat.exists\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eCopying SSH Keys to Ansible Host\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eTo allow secure, password-less communication between machines, public keys were copied to the \u003cstrong\u003eAnsible control machine\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Copy SSH keys to Ansible control machine\n  hosts: awsnodes\n  become: true\n  tasks:\n    - name: Fetch public SSH key from nodes\n      fetch:\n        src: \"~/.ssh/id_rsa.pub\"\n        dest: \"/root/awskeys/{{ inventory_hostname }}_id_rsa.pub\"\n        flat: yes\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eCopying SSH Keys to Target Nodes\u003c/strong\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Copy SSH keys to authorized_keys on target nodes\n  hosts: logserver\n  become: true\n  vars:\n    key_dir: /root/awskeys\n  tasks:\n    - name: Ensure .ssh directory exists\n      file:\n        path: \"/root/.ssh\"\n        state: directory\n        mode: \"0700\"\n\n    - name: Add public SSH keys\n      authorized_key:\n        user: \"root\"\n        key: \"{{ lookup('file', item) }}\"\n        state: present\n      with_fileglob: \"{{ key_dir }}/*_id_rsa.pub\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eOutcome\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eâœ… \u003cstrong\u003ePassword-less authentication\u003c/strong\u003e across all servers\u003cbr\u003e\nâœ… \u003cstrong\u003eHardened security\u003c/strong\u003e by eliminating password-based access\u003cbr\u003e\nâœ… \u003cstrong\u003eAutomated onboarding\u003c/strong\u003e for new machines with SSH authentication\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003e\u003cstrong\u003e2. Automated User and Sudoers Management\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eManaging users manually across multiple servers can lead to inconsistencies and security risks. Ansible was used to automate \u003cstrong\u003euser creation, privilege assignment, and sudoers configuration\u003c/strong\u003e.\u003c/p\u003e\n\u003ch3\u003e\u003cstrong\u003eCreating Users\u003c/strong\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Create users on all nodes\n  hosts: all\n  become: true\n  vars:\n    users:\n      - alice\n      - bob\n      - charlie\n  tasks:\n    - name: Add users\n      user:\n        name: \"{{ item }}\"\n        create_home: yes\n        state: present\n      loop: \"{{ users }}\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eGranting Sudo Privileges\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eTo enforce \u003cstrong\u003erole-based access control\u003c/strong\u003e, users were assigned to the sudoers file \u003cstrong\u003ewith strict validation\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Configure sudoers for specific users\n  hosts: all\n  become: true\n  tasks:\n    - name: Add users to sudoers\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        line: \"{{ item }} ALL=(ALL) NOPASSWD: ALL\"\n        validate: \"/usr/sbin/visudo -cf %s\"\n      loop: \"{{ users }}\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eOutcome\u003c/strong\u003e:\nâœ… \u003cstrong\u003eRole-based access management\u003c/strong\u003e\u003cbr\u003e\nâœ… \u003cstrong\u003eAutomated onboarding \u0026#x26; offboarding\u003c/strong\u003e of users\u003cbr\u003e\nâœ… \u003cstrong\u003eStrict sudoers validation\u003c/strong\u003e to prevent misconfigurations\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003e\u003cstrong\u003e3. Monitoring Sudo Commands and Logging Activity\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eTo improve security, all \u003ccode\u003esudo\u003c/code\u003e activity needed to be logged and monitored remotely.\u003c/p\u003e\n\u003ch3\u003e\u003cstrong\u003ePlaybook for Enabling Sudo Logging\u003c/strong\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Configure sudo logging\n  hosts: all\n  become: true\n  tasks:\n    - name: Add sudo replay logging\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        insertafter: '^# Defaults.*visiblepw'\n        line: |\n          Defaults log_output\n          Defaults!/usr/bin/sudoreplay !log_output\n          Defaults!/sbin/reboot !log_output\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eAutomated Log Collection and Sync\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eA script was deployed to \u003cstrong\u003eautomatically sync logs\u003c/strong\u003e from all nodes to a remote monitoring server.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e#!/bin/bash\nSRC=\"/var/log/sudo-io/\"\nDEST_DIR=\"/root/sudologs/{{ inventory_hostname }}/\"\nDEST_HOST=\"root@18.218.206.77\"\nSSH_PORT=4956\n\nssh -p \"$SSH_PORT\" -o StrictHostKeyChecking=no \"$DEST_HOST\" \"mkdir -p $DEST_DIR\"\nrsync -avz -e \"ssh -p $SSH_PORT -o StrictHostKeyChecking=no\" \"$SRC\" \"$DEST_HOST:$DEST_DIR\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eA \u003cstrong\u003ecron job\u003c/strong\u003e was configured to run this script \u003cstrong\u003eevery 12 hours\u003c/strong\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Schedule sudo log monitoring script\n  cron:\n    name: \"Monitor Sudo Logs\"\n    minute: \"0\"\n    hour: \"*/12\"\n    job: \"/root/monitor_sudo_logs.sh \u003e\u003e /var/log/monitor_sudo_logs.log 2\u003e\u0026#x26;1\"\n    state: present\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eOutcome\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eâœ… \u003cstrong\u003eCentralized sudo activity monitoring\u003c/strong\u003e\u003cbr\u003e\nâœ… \u003cstrong\u003eRegular log synchronization\u003c/strong\u003e for auditing\u003cbr\u003e\nâœ… \u003cstrong\u003ePrevention of privilege escalation attempts\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003e\u003cstrong\u003e4. Enhancing Security with Safe Deletion Policies\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eAccidental file deletions can cause \u003cstrong\u003eirreversible damage\u003c/strong\u003e. To prevent this, I implemented a \u003cstrong\u003esafe deletion wrapper script\u003c/strong\u003e.\u003c/p\u003e\n\u003ch3\u003e\u003cstrong\u003eSafe \u003ccode\u003erm\u003c/code\u003e Script\u003c/strong\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e#!/bin/bash\necho \"Warning: You are using the 'rm' command which deletes files permanently!\"\necho \"Files to be deleted: $@\"\nread -p \"Are you sure you want to continue? (y/n) \" -n 1 -r\necho\nif [[ $REPLY =~ ^[Yy]$ ]]\nthen\n    /bin/rm \"$@\"\nelse\n    echo \"Operation cancelled.\"\nfi\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eDeploying Safe \u003ccode\u003erm\u003c/code\u003e Script Using Ansible\u003c/strong\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Deploy safe_rm script\n  hosts: all\n  become: true\n  tasks:\n    - name: Copy safe_rm script\n      copy:\n        src: safe_rm.sh\n        dest: /usr/local/bin/safe_rm\n        mode: \"0755\"\n\n    - name: Alias rm to safe_rm\n      blockinfile:\n        path: /etc/profile\n        block: |\n          alias rm='safe_rm'\n        create: yes\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e\u003cstrong\u003eOutcome\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eâœ… \u003cstrong\u003ePrevention of accidental file deletions\u003c/strong\u003e\u003cbr\u003e\nâœ… \u003cstrong\u003eEnhanced safety while using \u003ccode\u003erm\u003c/code\u003e command\u003c/strong\u003e\u003cbr\u003e\nâœ… \u003cstrong\u003eForced user confirmation before permanent deletions\u003c/strong\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003e\u003cstrong\u003eFinal Takeaways\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eBy implementing Ansible automation, I was able to \u003cstrong\u003estreamline\u003c/strong\u003e system administration across multiple nodes, ensuring:\u003c/p\u003e\n\u003cp\u003eâœ” \u003cstrong\u003eSecure and password-less authentication\u003c/strong\u003e using SSH keys\u003cbr\u003e\nâœ” \u003cstrong\u003eAutomated user management\u003c/strong\u003e with structured onboarding \u0026#x26; offboarding\u003cbr\u003e\nâœ” \u003cstrong\u003eCentralized sudo monitoring\u003c/strong\u003e with periodic log collection\u003cbr\u003e\nâœ” \u003cstrong\u003eStrict sudoers file management\u003c/strong\u003e with validation to prevent errors\u003cbr\u003e\nâœ” \u003cstrong\u003eA safer file deletion process\u003c/strong\u003e with \u003ccode\u003esafe_rm\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThis project reinforced my skills in \u003cstrong\u003einfrastructure automation, security hardening, and scalable system management\u003c/strong\u003e. ðŸš€\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"12:T1b3d,"])</script><script>self.__next_f.push([1,"\n## **Introduction**\n\nInfrastructure automation is a critical aspect of modern system administration. My project focused on using **Ansible** to automate essential administrative tasks such as:\n\n- **Managing SSH Key Authentication**\n- **Creating and Removing Users Securely**\n- **Configuring Sudoers for Role-Based Access Control**\n- **Monitoring and Logging Sudo Actions**\n- **Deploying Security Enhancements (Safe Deletion, Password Policies, etc.)**\n\nThe primary goal was to create an automated, repeatable, and scalable solution for managing user access and securing the infrastructure.\n\n---\n\n## **1. SSH Key Management and Secure Access Automation**\n\nOne of the core challenges in multi-node environments is **secure authentication**. Instead of relying on password-based access, I automated **SSH key generation, distribution, and configuration**.\n\n### **Generating and Distributing SSH Keys**\nAnsible was used to generate SSH keys for different hosts and copy them to the appropriate machines.\n\n**Playbook for Generating SSH Keys (Conditional Execution to Avoid Overwriting):**\n```yaml\n- name: Generate SSH keys for root if they donâ€™t exist\n  hosts: all\n  become: false\n  tasks:\n    - name: Check if root SSH key exists\n      stat:\n        path: \"~/.ssh/id_rsa\"\n      register: ssh_key_check\n\n    - name: Generate SSH key for root\n      shell: ssh-keygen -t rsa -N '' -f ~/.ssh/id_rsa\n      when: not ssh_key_check.stat.exists\n```\n\n### **Copying SSH Keys to Ansible Host**\nTo allow secure, password-less communication between machines, public keys were copied to the **Ansible control machine**:\n\n```yaml\n- name: Copy SSH keys to Ansible control machine\n  hosts: awsnodes\n  become: true\n  tasks:\n    - name: Fetch public SSH key from nodes\n      fetch:\n        src: \"~/.ssh/id_rsa.pub\"\n        dest: \"/root/awskeys/{{ inventory_hostname }}_id_rsa.pub\"\n        flat: yes\n```\n\n### **Copying SSH Keys to Target Nodes**\n```yaml\n- name: Copy SSH keys to authorized_keys on target nodes\n  hosts: logserver\n  become: true\n  vars:\n    key_dir: /root/awskeys\n  tasks:\n    - name: Ensure .ssh directory exists\n      file:\n        path: \"/root/.ssh\"\n        state: directory\n        mode: \"0700\"\n\n    - name: Add public SSH keys\n      authorized_key:\n        user: \"root\"\n        key: \"{{ lookup('file', item) }}\"\n        state: present\n      with_fileglob: \"{{ key_dir }}/*_id_rsa.pub\"\n```\n\n### **Outcome**\nâœ… **Password-less authentication** across all servers  \nâœ… **Hardened security** by eliminating password-based access  \nâœ… **Automated onboarding** for new machines with SSH authentication  \n\n---\n\n## **2. Automated User and Sudoers Management**\n\nManaging users manually across multiple servers can lead to inconsistencies and security risks. Ansible was used to automate **user creation, privilege assignment, and sudoers configuration**.\n\n### **Creating Users**\n```yaml\n- name: Create users on all nodes\n  hosts: all\n  become: true\n  vars:\n    users:\n      - alice\n      - bob\n      - charlie\n  tasks:\n    - name: Add users\n      user:\n        name: \"{{ item }}\"\n        create_home: yes\n        state: present\n      loop: \"{{ users }}\"\n```\n\n### **Granting Sudo Privileges**\nTo enforce **role-based access control**, users were assigned to the sudoers file **with strict validation**:\n\n```yaml\n- name: Configure sudoers for specific users\n  hosts: all\n  become: true\n  tasks:\n    - name: Add users to sudoers\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        line: \"{{ item }} ALL=(ALL) NOPASSWD: ALL\"\n        validate: \"/usr/sbin/visudo -cf %s\"\n      loop: \"{{ users }}\"\n```\n\n**Outcome**:\nâœ… **Role-based access management**  \nâœ… **Automated onboarding \u0026 offboarding** of users  \nâœ… **Strict sudoers validation** to prevent misconfigurations  \n\n---\n\n## **3. Monitoring Sudo Commands and Logging Activity**\n\nTo improve security, all `sudo` activity needed to be logged and monitored remotely.\n\n### **Playbook for Enabling Sudo Logging**\n```yaml\n- name: Configure sudo logging\n  hosts: all\n  become: true\n  tasks:\n    - name: Add sudo replay logging\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        insertafter: '^# Defaults.*visiblepw'\n        line: |\n          Defaults log_output\n          Defaults!/usr/bin/sudoreplay !log_output\n          Defaults!/sbin/reboot !log_output\n```\n\n### **Automated Log Collection and Sync**\nA script was deployed to **automatically sync logs** from all nodes to a remote monitoring server.\n\n```bash\n#!/bin/bash\nSRC=\"/var/log/sudo-io/\"\nDEST_DIR=\"/root/sudologs/{{ inventory_hostname }}/\"\nDEST_HOST=\"root@18.218.206.77\"\nSSH_PORT=4956\n\nssh -p \"$SSH_PORT\" -o StrictHostKeyChecking=no \"$DEST_HOST\" \"mkdir -p $DEST_DIR\"\nrsync -avz -e \"ssh -p $SSH_PORT -o StrictHostKeyChecking=no\" \"$SRC\" \"$DEST_HOST:$DEST_DIR\"\n```\n\nA **cron job** was configured to run this script **every 12 hours**.\n\n```yaml\n- name: Schedule sudo log monitoring script\n  cron:\n    name: \"Monitor Sudo Logs\"\n    minute: \"0\"\n    hour: \"*/12\"\n    job: \"/root/monitor_sudo_logs.sh \u003e\u003e /var/log/monitor_sudo_logs.log 2\u003e\u00261\"\n    state: present\n```\n\n### **Outcome**\nâœ… **Centralized sudo activity monitoring**  \nâœ… **Regular log synchronization** for auditing  \nâœ… **Prevention of privilege escalation attempts**  \n\n---\n\n## **4. Enhancing Security with Safe Deletion Policies**\n\nAccidental file deletions can cause **irreversible damage**. To prevent this, I implemented a **safe deletion wrapper script**.\n\n### **Safe `rm` Script**\n```bash\n#!/bin/bash\necho \"Warning: You are using the 'rm' command which deletes files permanently!\"\necho \"Files to be deleted: $@\"\nread -p \"Are you sure you want to continue? (y/n) \" -n 1 -r\necho\nif [[ $REPLY =~ ^[Yy]$ ]]\nthen\n    /bin/rm \"$@\"\nelse\n    echo \"Operation cancelled.\"\nfi\n```\n\n### **Deploying Safe `rm` Script Using Ansible**\n```yaml\n- name: Deploy safe_rm script\n  hosts: all\n  become: true\n  tasks:\n    - name: Copy safe_rm script\n      copy:\n        src: safe_rm.sh\n        dest: /usr/local/bin/safe_rm\n        mode: \"0755\"\n\n    - name: Alias rm to safe_rm\n      blockinfile:\n        path: /etc/profile\n        block: |\n          alias rm='safe_rm'\n        create: yes\n```\n\n### **Outcome**\nâœ… **Prevention of accidental file deletions**  \nâœ… **Enhanced safety while using `rm` command**  \nâœ… **Forced user confirmation before permanent deletions**  \n\n---\n\n## **Final Takeaways**\n\nBy implementing Ansible automation, I was able to **streamline** system administration across multiple nodes, ensuring:\n\nâœ” **Secure and password-less authentication** using SSH keys  \nâœ” **Automated user management** with structured onboarding \u0026 offboarding  \nâœ” **Centralized sudo monitoring** with periodic log collection  \nâœ” **Strict sudoers file management** with validation to prevent errors  \nâœ” **A safer file deletion process** with `safe_rm`  \n\nThis project reinforced my skills in **infrastructure automation, security hardening, and scalable system management**. ðŸš€"])</script><script>self.__next_f.push([1,"4:[\"$\",\"$L10\",null,{\"project\":{\"id\":\"automating-secure-infrastructure-with-ansible-project\",\"metadata\":{\"title\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control\",\"date\":\"2021-12-12\",\"summary\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC). ðŸš€\",\"image\":\"https://raw.githubusercontent.com/digin1/web-images/main/ansible.png\",\"tag\":\"ansible, ubuntu\",\"featured\":\"yes\"},\"content\":\"$11\",\"rawContent\":\"$12\"}}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC). ðŸš€\"}],[\"$\",\"link\",\"4\",{\"rel\":\"author\",\"href\":\"https://digindominic.me\"}],[\"$\",\"meta\",\"5\",{\"name\":\"author\",\"content\":\"Digin Dominic\"}],[\"$\",\"meta\",\"6\",{\"name\":\"creator\",\"content\":\"Digin Dominic\"}],[\"$\",\"meta\",\"7\",{\"name\":\"publisher\",\"content\":\"Digin Dominic\"}],[\"$\",\"meta\",\"8\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"9\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"10\",{\"rel\":\"canonical\",\"href\":\"https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/\"}],[\"$\",\"meta\",\"11\",{\"name\":\"google-site-verification\",\"content\":\"your-google-verification-code\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:title\",\"content\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:description\",\"content\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC). ðŸš€\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:url\",\"content\":\"https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image\",\"content\":\"https://raw.githubusercontent.com/digin1/web-images/main/ansible.png\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"17\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"18\",{\"property\":\"og:image:alt\",\"content\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control\"}],[\"$\",\"meta\",\"19\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:title\",\"content\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic\"}],[\"$\",\"meta\",\"22\",{\"name\":\"twitter:description\",\"content\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC). ðŸš€\"}],[\"$\",\"meta\",\"23\",{\"name\":\"twitter:image\",\"content\":\"https://raw.githubusercontent.com/digin1/web-images/main/ansible.png\"}]]\n"])</script><script>self.__next_f.push([1,"3:null\n"])</script></body></html>