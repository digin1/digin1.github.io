<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/9d55f88cb514ddbb.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-b95fb25a3f22d0ff.js"/><script src="/_next/static/chunks/fd9d1056-a08c2fa1308a734a.js" async=""></script><script src="/_next/static/chunks/117-ab1e8bdf8ca43195.js" async=""></script><script src="/_next/static/chunks/main-app-27265cc5b3dcc92c.js" async=""></script><script src="/_next/static/chunks/870fdd6f-13b67920ea26e8d8.js" async=""></script><script src="/_next/static/chunks/69b09407-9eb0958119fc55ca.js" async=""></script><script src="/_next/static/chunks/812-5933561b11cc6dfa.js" async=""></script><script src="/_next/static/chunks/648-8a991ddcd93629d1.js" async=""></script><script src="/_next/static/chunks/519-b2943afe6571172d.js" async=""></script><script src="/_next/static/chunks/app/layout-c85ccb27cd7f4c58.js" async=""></script><script src="/_next/static/chunks/app/not-found-cd5d79832c6a66a3.js" async=""></script><script src="/_next/static/chunks/336-577e97483e52d43a.js" async=""></script><script src="/_next/static/chunks/app/projects/%5Bid%5D/page-167998e3958fc2b8.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-9KKL3BNRNY" as="script"/><link rel="icon" href="/favicon.ico" sizes="any"/><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/android-chrome-192x192.png"/><link rel="manifest" href="/manifest.json"/><meta name="theme-color" content="#3B82F6"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title>Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic</title><meta name="description" content="Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC)."/><link rel="author" href="https://digindominic.me"/><meta name="author" content="Digin Dominic"/><meta name="creator" content="Digin Dominic"/><meta name="publisher" content="Digin Dominic"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/"/><meta name="google-site-verification" content="your-google-verification-code"/><meta property="og:title" content="Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic"/><meta property="og:description" content="Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC)."/><meta property="og:url" content="https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/"/><meta property="og:image" content="https://digindominic.me/images/ansible.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic"/><meta name="twitter:description" content="Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC)."/><meta name="twitter:image" content="https://digindominic.me/images/ansible.png"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Digin Dominic","url":"https://digindominic.me","image":"/images/digin.png","jobTitle":"Full Stack Developer","description":"Full Stack Developer & Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.","sameAs":["https://github.com/digin1","https://linkedin.com/in/digin","https://twitter.com/digin1"],"knowsAbout":["React","Node.js","Python","JavaScript","TypeScript","Web Development","Software Engineering"]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Digin Dominic","url":"https://digindominic.me","description":"Full Stack Developer & Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.","author":{"@type":"Person","name":"Digin Dominic"},"potentialAction":{"@type":"SearchAction","target":"https://digindominic.me/projects?search={search_term_string}","query-input":"required name=search_term_string"}}</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="min-h-screen flex flex-col"><script src="/_next/static/chunks/webpack-b95fb25a3f22d0ff.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/9d55f88cb514ddbb.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"2:I[2846,[],\"\"]\n5:I[4707,[],\"\"]\n7:I[6423,[],\"\"]\n8:I[8003,[\"676\",\"static/chunks/870fdd6f-13b67920ea26e8d8.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"812\",\"static/chunks/812-5933561b11cc6dfa.js\",\"648\",\"static/chunks/648-8a991ddcd93629d1.js\",\"519\",\"static/chunks/519-b2943afe6571172d.js\",\"185\",\"static/chunks/app/layout-c85ccb27cd7f4c58.js\"],\"\"]\n9:I[9567,[\"676\",\"static/chunks/870fdd6f-13b67920ea26e8d8.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"812\",\"static/chunks/812-5933561b11cc6dfa.js\",\"648\",\"static/chunks/648-8a991ddcd93629d1.js\",\"519\",\"static/chunks/519-b2943afe6571172d.js\",\"185\",\"static/chunks/app/layout-c85ccb27cd7f4c58.js\"],\"ThemeProvider\"]\na:I[1794,[\"676\",\"static/chunks/870fdd6f-13b67920ea26e8d8.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"812\",\"static/chunks/812-5933561b11cc6dfa.js\",\"648\",\"static/chunks/648-8a991ddcd93629d1.js\",\"519\",\"static/chunks/519-b2943afe6571172d.js\",\"185\",\"static/chunks/app/layout-c85ccb27cd7f4c58.js\"],\"default\"]\nb:I[3039,[\"676\",\"static/chunks/870fdd6f-13b67920ea26e8d8.js\",\"812\",\"static/chunks/812-5933561b11cc6dfa.js\",\"648\",\"static/chunks/648-8a991ddcd93629d1.js\",\"160\",\"static/chunks/app/not-found-cd5d79832c6a66a3.js\"],\"default\"]\nc:I[9547,[\"676\",\"static/chunks/870fdd6f-13b67920ea26e8d8.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"812\",\"static/chunks/812-5933561b11cc6dfa.js\",\"648\",\"static/chunks/648-8a991ddcd93629d1.js\",\"519\",\"static/chunks/519-b2943afe6571172d.js\",\"185\",\"static/chunks/app/layout-c85ccb27cd7f4c58.js\"],\"default\"]\ne:I[1060,[],\"\"]\n6:[\"id\",\"automating-secure-infrastructure-with-ansible-project\",\"d\"]\nf:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L2\",null,{\"buildId\":\"hXqdy3fNMe3dQmkrMpocr\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"projects\",\"automating-secure-infrastructure-with-ansible-project\",\"\"],\"initialTree\":[\"\",{\"children\":[\"projects\",{\"children\":[[\"id\",\"automating-secure-infrastructure-with-ansible-project\",\"d\"],{\"children\":[\"__PAGE__?{\\\"id\\\":\\\"automating-secure-infrastructure-with-ansible-project\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"projects\",{\"children\":[[\"id\",\"automating-secure-infrastructure-with-ansible-project\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L3\",\"$L4\",null],null],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\",\"$6\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"projects\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9d55f88cb514ddbb.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"sizes\":\"any\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.svg\",\"type\":\"image/svg+xml\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/android-chrome-192x192.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/manifest.json\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#3B82F6\"}],[\"$\",\"link\",null,{\"rel\":\"sitemap\",\"type\":\"application/xml\",\"href\":\"/sitemap.xml\"}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Digin Dominic\\\",\\\"url\\\":\\\"https://digindominic.me\\\",\\\"image\\\":\\\"/images/digin.png\\\",\\\"jobTitle\\\":\\\"Full Stack Developer\\\",\\\"description\\\":\\\"Full Stack Developer \u0026 Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.\\\",\\\"sameAs\\\":[\\\"https://github.com/digin1\\\",\\\"https://linkedin.com/in/digin\\\",\\\"https://twitter.com/digin1\\\"],\\\"knowsAbout\\\":[\\\"React\\\",\\\"Node.js\\\",\\\"Python\\\",\\\"JavaScript\\\",\\\"TypeScript\\\",\\\"Web Development\\\",\\\"Software Engineering\\\"]}\"}}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"WebSite\\\",\\\"name\\\":\\\"Digin Dominic\\\",\\\"url\\\":\\\"https://digindominic.me\\\",\\\"description\\\":\\\"Full Stack Developer \u0026 Software Engineer specializing in React, Node.js, Python, and modern web technologies. Building scalable applications and research tools.\\\",\\\"author\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Digin Dominic\\\"},\\\"potentialAction\\\":{\\\"@type\\\":\\\"SearchAction\\\",\\\"target\\\":\\\"https://digindominic.me/projects?search={search_term_string}\\\",\\\"query-input\\\":\\\"required name=search_term_string\\\"}}\"}}]]}],[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col\",\"children\":[[\"$\",\"$L8\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-9KKL3BNRNY\",\"strategy\":\"afterInteractive\"}],[\"$\",\"$L8\",null,{\"id\":\"google-analytics\",\"strategy\":\"afterInteractive\",\"children\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', 'G-9KKL3BNRNY');\\n          \"}],[\"$\",\"$L9\",null,{\"children\":[[\"$\",\"$La\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 pt-20\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$Lb\",null,{}],\"notFoundStyles\":[]}]}],[\"$\",\"$Lc\",null,{}]]}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Ld\"],\"globalErrorComponent\":\"$e\",\"missingSlots\":\"$Wf\"}]\n"])</script><script>self.__next_f.push([1,"10:I[8966,[\"676\",\"static/chunks/870fdd6f-13b67920ea26e8d8.js\",\"958\",\"static/chunks/69b09407-9eb0958119fc55ca.js\",\"812\",\"static/chunks/812-5933561b11cc6dfa.js\",\"648\",\"static/chunks/648-8a991ddcd93629d1.js\",\"336\",\"static/chunks/336-577e97483e52d43a.js\",\"626\",\"static/chunks/app/projects/%5Bid%5D/page-167998e3958fc2b8.js\"],\"default\"]\n11:T1d22,"])</script><script>self.__next_f.push([1,"\u003ch2\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eInfrastructure automation is a critical aspect of modern system administration. My project focused on using Ansible to automate essential administrative tasks such as:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eManaging SSH Key Authentication\u003c/li\u003e\n\u003cli\u003eCreating and Removing Users Securely\u003c/li\u003e\n\u003cli\u003eConfiguring Sudoers for Role-Based Access Control\u003c/li\u003e\n\u003cli\u003eMonitoring and Logging Sudo Actions\u003c/li\u003e\n\u003cli\u003eDeploying Security Enhancements (Safe Deletion, Password Policies, etc.)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe primary goal was to create an automated, repeatable, and scalable solution for managing user access and securing the infrastructure.\u003c/p\u003e\n\u003ch2\u003e1. SSH Key Management and Secure Access Automation\u003c/h2\u003e\n\u003cp\u003eOne of the core challenges in multi-node environments is secure authentication. Instead of relying on password-based access, I automated SSH key generation, distribution, and configuration.\u003c/p\u003e\n\u003ch3\u003eGenerating and Distributing SSH Keys\u003c/h3\u003e\n\u003cp\u003eAnsible was used to generate SSH keys for different hosts and copy them to the appropriate machines.\u003c/p\u003e\n\u003cp\u003ePlaybook for Generating SSH Keys (Conditional Execution to Avoid Overwriting):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Generate SSH keys for root if they don’t exist\n  hosts: all\n  become: false\n  tasks:\n    - name: Check if root SSH key exists\n      stat:\n        path: \"~/.ssh/id_rsa\"\n      register: ssh_key_check\n\n    - name: Generate SSH key for root\n      shell: ssh-keygen -t rsa -N '' -f ~/.ssh/id_rsa\n      when: not ssh_key_check.stat.exists\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eCopying SSH Keys to Ansible Host\u003c/h3\u003e\n\u003cp\u003eTo allow secure, password-less communication between machines, public keys were copied to the Ansible control machine:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Copy SSH keys to Ansible control machine\n  hosts: awsnodes\n  become: true\n  tasks:\n    - name: Fetch public SSH key from nodes\n      fetch:\n        src: \"~/.ssh/id_rsa.pub\"\n        dest: \"/root/awskeys/{{ inventory_hostname }}_id_rsa.pub\"\n        flat: yes\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eCopying SSH Keys to Target Nodes\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Copy SSH keys to authorized_keys on target nodes\n  hosts: logserver\n  become: true\n  vars:\n    key_dir: /root/awskeys\n  tasks:\n    - name: Ensure .ssh directory exists\n      file:\n        path: \"/root/.ssh\"\n        state: directory\n        mode: \"0700\"\n\n    - name: Add public SSH keys\n      authorized_key:\n        user: \"root\"\n        key: \"{{ lookup('file', item) }}\"\n        state: present\n      with_fileglob: \"{{ key_dir }}/*_id_rsa.pub\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eOutcome\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePassword-less authentication across all servers\u003c/li\u003e\n\u003cli\u003eHardened security by eliminating password-based access\u003c/li\u003e\n\u003cli\u003eAutomated onboarding for new machines with SSH authentication\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e2. Automated User and Sudoers Management\u003c/h2\u003e\n\u003cp\u003eManaging users manually across multiple servers can lead to inconsistencies and security risks. Ansible was used to automate user creation, privilege assignment, and sudoers configuration.\u003c/p\u003e\n\u003ch3\u003eCreating Users\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Create users on all nodes\n  hosts: all\n  become: true\n  vars:\n    users:\n      - alice\n      - bob\n      - charlie\n  tasks:\n    - name: Add users\n      user:\n        name: \"{{ item }}\"\n        create_home: yes\n        state: present\n      loop: \"{{ users }}\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eGranting Sudo Privileges\u003c/h3\u003e\n\u003cp\u003eTo enforce role-based access control, users were assigned to the sudoers file with strict validation:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Configure sudoers for specific users\n  hosts: all\n  become: true\n  tasks:\n    - name: Add users to sudoers\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        line: \"{{ item }} ALL=(ALL) NOPASSWD: ALL\"\n        validate: \"/usr/sbin/visudo -cf %s\"\n      loop: \"{{ users }}\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eOutcome\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eRole-based access management\u003c/li\u003e\n\u003cli\u003eAutomated onboarding \u0026#x26; offboarding of users\u003c/li\u003e\n\u003cli\u003eStrict sudoers validation to prevent misconfigurations\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e3. Monitoring Sudo Commands and Logging Activity\u003c/h2\u003e\n\u003cp\u003eTo improve security, all \u003ccode\u003esudo\u003c/code\u003e activity needed to be logged and monitored remotely.\u003c/p\u003e\n\u003ch3\u003ePlaybook for Enabling Sudo Logging\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Configure sudo logging\n  hosts: all\n  become: true\n  tasks:\n    - name: Add sudo replay logging\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        insertafter: '^# Defaults.*visiblepw'\n        line: |\n          Defaults log_output\n          Defaults!/usr/bin/sudoreplay !log_output\n          Defaults!/sbin/reboot !log_output\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eAutomated Log Collection and Sync\u003c/h3\u003e\n\u003cp\u003eA script was deployed to automatically sync logs from all nodes to a remote monitoring server.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e#!/bin/bash\nSRC=\"/var/log/sudo-io/\"\nDEST_DIR=\"/root/sudologs/{{ inventory_hostname }}/\"\nDEST_HOST=\"root@18.218.206.77\"\nSSH_PORT=4956\n\nssh -p \"$SSH_PORT\" -o StrictHostKeyChecking=no \"$DEST_HOST\" \"mkdir -p $DEST_DIR\"\nrsync -avz -e \"ssh -p $SSH_PORT -o StrictHostKeyChecking=no\" \"$SRC\" \"$DEST_HOST:$DEST_DIR\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eA cron job was configured to run this script every 12 hours.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Schedule sudo log monitoring script\n  cron:\n    name: \"Monitor Sudo Logs\"\n    minute: \"0\"\n    hour: \"*/12\"\n    job: \"/root/monitor_sudo_logs.sh \u003e\u003e /var/log/monitor_sudo_logs.log 2\u003e\u0026#x26;1\"\n    state: present\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eOutcome\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eCentralized sudo activity monitoring\u003c/li\u003e\n\u003cli\u003eRegular log synchronization for auditing\u003c/li\u003e\n\u003cli\u003ePrevention of privilege escalation attempts\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e4. Enhancing Security with Safe Deletion Policies\u003c/h2\u003e\n\u003cp\u003eAccidental file deletions can cause irreversible damage. To prevent this, I implemented a safe deletion wrapper script.\u003c/p\u003e\n\u003ch3\u003eSafe \u003ccode\u003erm\u003c/code\u003e Script\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e#!/bin/bash\necho \"Warning: You are using the 'rm' command which deletes files permanently!\"\necho \"Files to be deleted: $@\"\nread -p \"Are you sure you want to continue? (y/n) \" -n 1 -r\necho\nif [[ $REPLY =~ ^[Yy]$ ]]\nthen\n    /bin/rm \"$@\"\nelse\n    echo \"Operation cancelled.\"\nfi\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eDeploying Safe \u003ccode\u003erm\u003c/code\u003e Script Using Ansible\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e- name: Deploy safe_rm script\n  hosts: all\n  become: true\n  tasks:\n    - name: Copy safe_rm script\n      copy:\n        src: safe_rm.sh\n        dest: /usr/local/bin/safe_rm\n        mode: \"0755\"\n\n    - name: Alias rm to safe_rm\n      blockinfile:\n        path: /etc/profile\n        block: |\n          alias rm='safe_rm'\n        create: yes\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eOutcome\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003ePrevention of accidental file deletions\u003c/li\u003e\n\u003cli\u003eEnhanced safety while using \u003ccode\u003erm\u003c/code\u003e command\u003c/li\u003e\n\u003cli\u003eForced user confirmation before permanent deletions\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eFinal Takeaways\u003c/h2\u003e\n\u003cp\u003eBy implementing Ansible automation, I was able to streamline system administration across multiple nodes, ensuring:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSecure and password-less authentication using SSH keys\u003c/li\u003e\n\u003cli\u003eAutomated user management with structured onboarding \u0026#x26; offboarding\u003c/li\u003e\n\u003cli\u003eCentralized sudo monitoring with periodic log collection\u003c/li\u003e\n\u003cli\u003eStrict sudoers file management with validation to prevent errors\u003c/li\u003e\n\u003cli\u003eA safer file deletion process with \u003ccode\u003esafe_rm\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis project reinforced my skills in infrastructure automation, security hardening, and scalable system management.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"12:T19fe,"])</script><script>self.__next_f.push([1,"\n## Introduction\n\nInfrastructure automation is a critical aspect of modern system administration. My project focused on using Ansible to automate essential administrative tasks such as:\n\n- Managing SSH Key Authentication\n- Creating and Removing Users Securely\n- Configuring Sudoers for Role-Based Access Control\n- Monitoring and Logging Sudo Actions\n- Deploying Security Enhancements (Safe Deletion, Password Policies, etc.)\n\nThe primary goal was to create an automated, repeatable, and scalable solution for managing user access and securing the infrastructure.\n\n## 1. SSH Key Management and Secure Access Automation\n\nOne of the core challenges in multi-node environments is secure authentication. Instead of relying on password-based access, I automated SSH key generation, distribution, and configuration.\n\n### Generating and Distributing SSH Keys\nAnsible was used to generate SSH keys for different hosts and copy them to the appropriate machines.\n\nPlaybook for Generating SSH Keys (Conditional Execution to Avoid Overwriting):\n```yaml\n- name: Generate SSH keys for root if they don’t exist\n  hosts: all\n  become: false\n  tasks:\n    - name: Check if root SSH key exists\n      stat:\n        path: \"~/.ssh/id_rsa\"\n      register: ssh_key_check\n\n    - name: Generate SSH key for root\n      shell: ssh-keygen -t rsa -N '' -f ~/.ssh/id_rsa\n      when: not ssh_key_check.stat.exists\n```\n\n### Copying SSH Keys to Ansible Host\nTo allow secure, password-less communication between machines, public keys were copied to the Ansible control machine:\n\n```yaml\n- name: Copy SSH keys to Ansible control machine\n  hosts: awsnodes\n  become: true\n  tasks:\n    - name: Fetch public SSH key from nodes\n      fetch:\n        src: \"~/.ssh/id_rsa.pub\"\n        dest: \"/root/awskeys/{{ inventory_hostname }}_id_rsa.pub\"\n        flat: yes\n```\n\n### Copying SSH Keys to Target Nodes\n```yaml\n- name: Copy SSH keys to authorized_keys on target nodes\n  hosts: logserver\n  become: true\n  vars:\n    key_dir: /root/awskeys\n  tasks:\n    - name: Ensure .ssh directory exists\n      file:\n        path: \"/root/.ssh\"\n        state: directory\n        mode: \"0700\"\n\n    - name: Add public SSH keys\n      authorized_key:\n        user: \"root\"\n        key: \"{{ lookup('file', item) }}\"\n        state: present\n      with_fileglob: \"{{ key_dir }}/*_id_rsa.pub\"\n```\n\n### Outcome\n* Password-less authentication across all servers\n* Hardened security by eliminating password-based access\n* Automated onboarding for new machines with SSH authentication\n\n## 2. Automated User and Sudoers Management\n\nManaging users manually across multiple servers can lead to inconsistencies and security risks. Ansible was used to automate user creation, privilege assignment, and sudoers configuration.\n\n### Creating Users\n```yaml\n- name: Create users on all nodes\n  hosts: all\n  become: true\n  vars:\n    users:\n      - alice\n      - bob\n      - charlie\n  tasks:\n    - name: Add users\n      user:\n        name: \"{{ item }}\"\n        create_home: yes\n        state: present\n      loop: \"{{ users }}\"\n```\n\n### Granting Sudo Privileges\nTo enforce role-based access control, users were assigned to the sudoers file with strict validation:\n\n```yaml\n- name: Configure sudoers for specific users\n  hosts: all\n  become: true\n  tasks:\n    - name: Add users to sudoers\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        line: \"{{ item }} ALL=(ALL) NOPASSWD: ALL\"\n        validate: \"/usr/sbin/visudo -cf %s\"\n      loop: \"{{ users }}\"\n```\n\n### Outcome\n* Role-based access management\n* Automated onboarding \u0026 offboarding of users\n* Strict sudoers validation to prevent misconfigurations\n\n## 3. Monitoring Sudo Commands and Logging Activity\n\nTo improve security, all `sudo` activity needed to be logged and monitored remotely.\n\n### Playbook for Enabling Sudo Logging\n```yaml\n- name: Configure sudo logging\n  hosts: all\n  become: true\n  tasks:\n    - name: Add sudo replay logging\n      lineinfile:\n        path: /etc/sudoers\n        state: present\n        insertafter: '^# Defaults.*visiblepw'\n        line: |\n          Defaults log_output\n          Defaults!/usr/bin/sudoreplay !log_output\n          Defaults!/sbin/reboot !log_output\n```\n\n### Automated Log Collection and Sync\nA script was deployed to automatically sync logs from all nodes to a remote monitoring server.\n\n```bash\n#!/bin/bash\nSRC=\"/var/log/sudo-io/\"\nDEST_DIR=\"/root/sudologs/{{ inventory_hostname }}/\"\nDEST_HOST=\"root@18.218.206.77\"\nSSH_PORT=4956\n\nssh -p \"$SSH_PORT\" -o StrictHostKeyChecking=no \"$DEST_HOST\" \"mkdir -p $DEST_DIR\"\nrsync -avz -e \"ssh -p $SSH_PORT -o StrictHostKeyChecking=no\" \"$SRC\" \"$DEST_HOST:$DEST_DIR\"\n```\n\nA cron job was configured to run this script every 12 hours.\n\n```yaml\n- name: Schedule sudo log monitoring script\n  cron:\n    name: \"Monitor Sudo Logs\"\n    minute: \"0\"\n    hour: \"*/12\"\n    job: \"/root/monitor_sudo_logs.sh \u003e\u003e /var/log/monitor_sudo_logs.log 2\u003e\u00261\"\n    state: present\n```\n\n### Outcome\n* Centralized sudo activity monitoring\n* Regular log synchronization for auditing\n* Prevention of privilege escalation attempts\n\n## 4. Enhancing Security with Safe Deletion Policies\n\nAccidental file deletions can cause irreversible damage. To prevent this, I implemented a safe deletion wrapper script.\n\n### Safe `rm` Script\n```bash\n#!/bin/bash\necho \"Warning: You are using the 'rm' command which deletes files permanently!\"\necho \"Files to be deleted: $@\"\nread -p \"Are you sure you want to continue? (y/n) \" -n 1 -r\necho\nif [[ $REPLY =~ ^[Yy]$ ]]\nthen\n    /bin/rm \"$@\"\nelse\n    echo \"Operation cancelled.\"\nfi\n```\n\n### Deploying Safe `rm` Script Using Ansible\n```yaml\n- name: Deploy safe_rm script\n  hosts: all\n  become: true\n  tasks:\n    - name: Copy safe_rm script\n      copy:\n        src: safe_rm.sh\n        dest: /usr/local/bin/safe_rm\n        mode: \"0755\"\n\n    - name: Alias rm to safe_rm\n      blockinfile:\n        path: /etc/profile\n        block: |\n          alias rm='safe_rm'\n        create: yes\n```\n\n### Outcome\n* Prevention of accidental file deletions\n* Enhanced safety while using `rm` command\n* Forced user confirmation before permanent deletions\n\n## Final Takeaways\n\nBy implementing Ansible automation, I was able to streamline system administration across multiple nodes, ensuring:\n\n* Secure and password-less authentication using SSH keys\n* Automated user management with structured onboarding \u0026 offboarding\n* Centralized sudo monitoring with periodic log collection\n* Strict sudoers file management with validation to prevent errors\n* A safer file deletion process with `safe_rm`\n\nThis project reinforced my skills in infrastructure automation, security hardening, and scalable system management."])</script><script>self.__next_f.push([1,"4:[\"$\",\"$L10\",null,{\"project\":{\"id\":\"automating-secure-infrastructure-with-ansible-project\",\"metadata\":{\"title\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control\",\"date\":\"2021-12-12\",\"featured\":true,\"featuredOrder\":8,\"category\":\"education\",\"summary\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC).\",\"image\":\"/images/ansible.png\",\"tag\":\"Ansible, Ubuntu, Linux, DevOps, Infrastructure as Code\",\"role\":\"DevOps Engineer\",\"duration\":\"2 weeks\"},\"content\":\"$11\",\"rawContent\":\"$12\"},\"prevProject\":{\"id\":\"deep-chill-inventory-management-system\",\"title\":\"Deep Chill Inventory Management System\"},\"nextProject\":{\"id\":\"code-pad-me--online-code-execution-system\",\"title\":\"Code-Pad.me - Award-Winning Online Code Execution System\"}}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC).\"}],[\"$\",\"link\",\"4\",{\"rel\":\"author\",\"href\":\"https://digindominic.me\"}],[\"$\",\"meta\",\"5\",{\"name\":\"author\",\"content\":\"Digin Dominic\"}],[\"$\",\"meta\",\"6\",{\"name\":\"creator\",\"content\":\"Digin Dominic\"}],[\"$\",\"meta\",\"7\",{\"name\":\"publisher\",\"content\":\"Digin Dominic\"}],[\"$\",\"meta\",\"8\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"9\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"10\",{\"rel\":\"canonical\",\"href\":\"https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/\"}],[\"$\",\"meta\",\"11\",{\"name\":\"google-site-verification\",\"content\":\"your-google-verification-code\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:title\",\"content\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:description\",\"content\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC).\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:url\",\"content\":\"https://digindominic.me/projects/automating-secure-infrastructure-with-ansible-project/\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image\",\"content\":\"https://digindominic.me/images/ansible.png\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"17\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"18\",{\"property\":\"og:image:alt\",\"content\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control\"}],[\"$\",\"meta\",\"19\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:title\",\"content\":\"Automating Secure Infrastructure with Ansible: Managing SSH, Sudoers, and User Access Control | Digin Dominic\"}],[\"$\",\"meta\",\"22\",{\"name\":\"twitter:description\",\"content\":\"Automating Secure Infrastructure with Ansible streamlines SSH key management, user provisioning, and sudoers configuration to enhance security and efficiency. This project ensures password-less authentication, centralized sudo monitoring, and safe system administration through Infrastructure as Code (IaC).\"}],[\"$\",\"meta\",\"23\",{\"name\":\"twitter:image\",\"content\":\"https://digindominic.me/images/ansible.png\"}]]\n"])</script><script>self.__next_f.push([1,"3:null\n"])</script></body></html>